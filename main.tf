module "fargate" {
  source                            = "git@github.com:traveloka/terraform-aws-discovery-ecs-service?ref=v0.1.0"
  service_name                      = "${local.service_name}"
  product_domain                    = "${local.product_domain}"
  environment                       = "${var.environment}"
  cluster_role                      = "${var.cluster_role}"
  application                       = "${local.application}"
  container_name                    = "${var.container_name}"
  container_image                   = "${module.ecr.repository_url}:${var.container_image_version}"
  port_mappings                     = "${local.port_mappings}"
  container_environment             = "${local.container_environment}"
  awslogs_region                    = "${var.region}"
  awslogs_stream_prefix             = "${var.container_name}/${var.container_image_version}/"
  ecs_cluster_arn                   = "${var.ecs_cluster_arn}"
  deployment_controller_type        = "${var.deployment_controller_type}"
  subnet_ids                        = "${var.subnet_ids}"
  security_group_ids                = ["${aws_security_group.app.id}"]
  task_role_arn                     = "${module.task_role.role_arn}"
  desired_count                     = "${var.desired_count}"
  task_cpu                          = "${var.task_cpu}"
  task_memory                       = "${var.task_memory}"
  alb_arn                           = "${module.lb.lb_arn}"
  health_check_grace_period_seconds = "${var.health_check_grace_period_seconds}"
  propagate_tags                    = "SERVICE"
  ecs_load_balancers                = "${local.ecs_load_balancers}"
}
